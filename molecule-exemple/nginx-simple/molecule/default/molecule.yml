---
# üîß FICHIER DE CONFIGURATION MOLECULE
# Ce fichier d√©finit comment Molecule va tester notre r√¥le

# D√©finit les d√©pendances externes (autres r√¥les n√©cessaires)
dependency:
  name: galaxy

# D√©finit le driver (comment cr√©er l'environnement de test)
# Ici on utilise Docker pour cr√©er un conteneur
driver:
  name: docker

# D√©finit les plateformes sur lesquelles tester
# On peut tester sur plusieurs OS diff√©rents !
platforms:
  - name: instance  # Nom du conteneur
    image: geerlingguy/docker-ubuntu2204-ansible:latest  # Image Docker √† utiliser
    pre_build_image: true  # Utiliser l'image telle quelle (ne pas la rebuilder)
    privileged: true  # N√©cessaire pour systemd
    volumes:
      - /sys/fs/cgroup:/sys/fs/cgroup:rw  # N√©cessaire pour systemd
    cgroupns_mode: host  # N√©cessaire pour systemd
    command: /lib/systemd/systemd  # Commande de d√©marrage

# D√©finit le provisioner (comment appliquer le r√¥le)
provisioner:
  name: ansible
  playbooks:
    converge: converge.yml  # Playbook qui applique le r√¥le
    verify: verify.yml      # Playbook qui v√©rifie le r√©sultat
  env:
    ANSIBLE_ROLES_PATH: ${MOLECULE_PROJECT_DIRECTORY}/..

# D√©finit le verifier (comment v√©rifier que tout fonctionne)
verifier:
  name: ansible


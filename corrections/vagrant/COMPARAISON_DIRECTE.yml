---
# ============================================================================
# âš¡ COMPARAISON DIRECTE : 2 Minutes pour Comprendre
# ============================================================================
#
# Ce playbook montre LA diffÃ©rence clÃ© en moins de 2 minutes
# IdÃ©al pour une dÃ©monstration rapide en dÃ©but de cours
#
# USAGE : ansible-playbook COMPARAISON_DIRECTE.yml
#
# ============================================================================

# ============================================================================
# ğŸ”´ PLAY 1 : Ã‰CHEC avec import_tasks
# ============================================================================

- name: "ğŸ”´ Ã‰CHEC : import_tasks avec variable dynamique"
  hosts: localhost
  connection: local
  gather_facts: no

  tasks:
    - name: "ğŸ“ DÃ©finir une variable"
      ansible.builtin.set_fact:
        fichier: "taches.yml"
    
    # âŒ CECI VA Ã‰CHOUER
    - name: "ğŸš« Import avec variable"
      ansible.builtin.import_tasks: "{{ fichier }}"
      # Erreur : variable non dÃ©finie au parse time

# Si vous voulez continuer aprÃ¨s l'Ã©chec, commentez le play ci-dessus
# et dÃ©commentez celui ci-dessous :

# ============================================================================
# âœ… PLAY 2 : SUCCÃˆS avec include_tasks
# ============================================================================

# - name: "âœ… SUCCÃˆS : include_tasks avec variable dynamique"
#   hosts: localhost
#   connection: local
#   gather_facts: no
# 
#   tasks:
#     - name: "ğŸ“ CrÃ©er un fichier de tÃ¢ches temporaire"
#       ansible.builtin.copy:
#         content: |
#           ---
#           - name: "TÃ¢che incluse dynamiquement"
#             ansible.builtin.debug:
#               msg: "âœ… SuccÃ¨s ! J'ai Ã©tÃ© chargÃ© avec une variable !"
#         dest: "/tmp/taches_dynamiques.yml"
#     
#     - name: "ğŸ“ DÃ©finir une variable"
#       ansible.builtin.set_fact:
#         fichier: "/tmp/taches_dynamiques.yml"
#     
#     # âœ… CECI VA RÃ‰USSIR
#     - name: "âœ… Include avec variable"
#       ansible.builtin.include_tasks: "{{ fichier }}"
#       # SuccÃ¨s : variable rÃ©solue au run time
#     
#     - name: "ğŸ§¹ Nettoyage"
#       ansible.builtin.file:
#         path: "/tmp/taches_dynamiques.yml"
#         state: absent

# ============================================================================
# ğŸ’¡ EXPLICATION EN 30 SECONDES
# ============================================================================
#
# import_tasks :
#   â€¢ Ã‰valuÃ© AVANT l'exÃ©cution (parse time)
#   â€¢ La variable {{ fichier }} n'existe pas encore
#   â€¢ âŒ Ã‰CHEC
#
# include_tasks :
#   â€¢ Ã‰valuÃ© PENDANT l'exÃ©cution (run time)
#   â€¢ La variable {{ fichier }} existe dÃ©jÃ 
#   â€¢ âœ… SUCCÃˆS
#
# ============================================================================
# RÃˆGLE D'OR
# ============================================================================
#
#   Nom de fichier FIXE     â†’  import_tasks
#   Nom de fichier VARIABLE â†’  include_tasks
#
# ============================================================================

---
# ============================================================================
# ğŸ¯ EXEMPLE COMPARATIF COMPLET (cÃ´te Ã  cÃ´te)
# ============================================================================

- name: "ğŸ“Š Comparaison complÃ¨te import vs include"
  hosts: localhost
  connection: local
  gather_facts: yes

  tasks:
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    # SECTION 1 : Nom de fichier fixe
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    - name: "ğŸ“‹ Section 1 : Nom de fichier FIXE"
      ansible.builtin.debug:
        msg: "=== Les DEUX mÃ©thodes fonctionnent ==="

    - name: "ğŸ“ CrÃ©er un fichier de tÃ¢ches fixe"
      ansible.builtin.copy:
        content: |
          ---
          - name: "TÃ¢che depuis fichier fixe"
            ansible.builtin.debug:
              msg: "Je viens d'un fichier au nom fixe"
        dest: "/tmp/taches_fixes.yml"

    # âœ… Fonctionne avec import_tasks
    - name: "âœ… import_tasks avec nom FIXE"
      ansible.builtin.import_tasks: /tmp/taches_fixes.yml

    # âœ… Fonctionne avec include_tasks
    - name: "âœ… include_tasks avec nom FIXE"
      ansible.builtin.include_tasks: /tmp/taches_fixes.yml

    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    # SECTION 2 : Nom de fichier avec VARIABLE
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    - name: "ğŸ“‹ Section 2 : Nom de fichier avec VARIABLE"
      ansible.builtin.debug:
        msg: "=== Seul include_tasks fonctionne ==="

    - name: "ğŸ“ CrÃ©er un fichier selon l'OS"
      ansible.builtin.copy:
        content: |
          ---
          - name: "TÃ¢che spÃ©cifique Ã  l'OS"
            ansible.builtin.debug:
              msg: "Configuration pour {{ ansible_os_family }}"
        dest: "/tmp/taches_{{ ansible_os_family | lower }}.yml"

    # âŒ Ne fonctionne PAS avec import_tasks (dÃ©commentÃ© = Ã©chec)
    # - name: "ğŸš« import_tasks avec VARIABLE (va Ã©chouer)"
    #   ansible.builtin.import_tasks: "/tmp/taches_{{ ansible_os_family | lower }}.yml"

    # âœ… Fonctionne avec include_tasks
    - name: "âœ… include_tasks avec VARIABLE"
      ansible.builtin.include_tasks: "/tmp/taches_{{ ansible_os_family | lower }}.yml"

    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    # SECTION 3 : BOUCLE
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    - name: "ğŸ“‹ Section 3 : BOUCLE"
      ansible.builtin.debug:
        msg: "=== Seul include_tasks supporte les boucles ==="

    - name: "ğŸ“ CrÃ©er un fichier pour la boucle"
      ansible.builtin.copy:
        content: |
          ---
          - name: "TÃ¢che en boucle"
            ansible.builtin.debug:
              msg: "ItÃ©ration pour : {{ item }}"
        dest: "/tmp/taches_loop.yml"

    # âŒ IMPOSSIBLE avec import_tasks (dÃ©commentÃ© = Ã©chec)
    # - name: "ğŸš« import_tasks avec loop (impossible)"
    #   ansible.builtin.import_tasks: /tmp/taches_loop.yml
    #   loop: [un, deux, trois]

    # âœ… Fonctionne avec include_tasks
    - name: "âœ… include_tasks avec loop"
      ansible.builtin.include_tasks: /tmp/taches_loop.yml
      loop:
        - un
        - deux
        - trois

    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    # NETTOYAGE
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    - name: "ğŸ§¹ Nettoyage des fichiers temporaires"
      ansible.builtin.file:
        path: "{{ item }}"
        state: absent
      loop:
        - /tmp/taches_fixes.yml
        - "/tmp/taches_{{ ansible_os_family | lower }}.yml"
        - /tmp/taches_loop.yml

    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    # RÃ‰SUMÃ‰ FINAL
    # â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

    - name: "ğŸ“Š RÃ‰SUMÃ‰"
      ansible.builtin.debug:
        msg: |
          
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘                  TABLEAU COMPARATIF FINAL                    â•‘
          â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
          â•‘                                                              â•‘
          â•‘  CAS D'USAGE          â”‚ import_tasks  â”‚ include_tasks       â•‘
          â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â•‘
          â•‘  Nom fixe             â”‚ âœ… OUI        â”‚ âœ… OUI              â•‘
          â•‘  Nom avec variable    â”‚ âŒ NON        â”‚ âœ… OUI              â•‘
          â•‘  Avec boucle (loop)   â”‚ âŒ NON        â”‚ âœ… OUI              â•‘
          â•‘  Tags visibles        â”‚ âœ… OUI        â”‚ âŒ NON              â•‘
          â•‘  Performance          â”‚ âœ… Meilleure  â”‚ âš ï¸ LÃ©gÃ¨rement -     â•‘
          â•‘                                                              â•‘
          â•‘  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•    â•‘
          â•‘                                                              â•‘
          â•‘  RÃˆGLE D'OR :                                                â•‘
          â•‘                                                              â•‘
          â•‘  â€¢ Fixe et simple    â†’ import_tasks                          â•‘
          â•‘  â€¢ Variable/Boucle   â†’ include_tasks                         â•‘
          â•‘                                                              â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ============================================================================
# FIN DE LA DÃ‰MONSTRATION
# ============================================================================

